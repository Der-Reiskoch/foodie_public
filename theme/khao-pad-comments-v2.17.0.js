import"./modulepreload-polyfill.js";const u={method:"GET",interval:6e4},h={method:"POST"},l={read:u,write:h},d=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),v=(e,t,o)=>{const n={};d(t,"sectionId")&&(n.sid=t.sectionId),d(t,"pageId")&&(n.pid=t.pageId);let s=!0;for(const r in n){if(d(n,r)){const a=n[r];a&&(e+=(s?"?":"&")+r+"="+encodeURIComponent(a))}s=!1}if(d(n,"sid")&&d(n,"pid")){const r=new XMLHttpRequest;r.open(l.read.method,e),r.onload=()=>{o(r.responseText)},r.send()}else console.error("no sectionId or pageId")},D=(e,t,o)=>{const n=new FormData;for(const r in t)t.hasOwnProperty(r)&&n.append(r,t[r]);const s=new XMLHttpRequest;s.open(l.write.method,e),s.onload=()=>{o(s.responseText)},s.send(n)},g=function(){const e=["cache"];window.caches.keys().then(t=>Promise.all(t.map(o=>{if(!e.includes(o))return window.caches.delete(o)})))},C=e=>{let t="";return e&&(t=e.replace(/(?:\r\n|\r|\n)/g,"<br>")),t},f=e=>{let t=null;return e&&(t=document.createElement("div"),t.className="row",t.innerHTML=e),t},y=(e,t,o)=>{let n="";return e&&o&&(n=`<div class="meta"><div class="name">${t?`<a href="${t}" target="_blank" rel="noopener">${e}</a>`:e}</div><div class="time">${o}</div></div>`),n},w=(e,t,o,n,s)=>{let r="";if(e&&o){let a="";s&&(s.toLowerCase()==="author"&&(a="from-author"),s.toLowerCase()==="to-be-approved"&&(a="to-be-approved"));const c=y(e,t,n);r=`<div class="msg ${a}">${o}</div>`+c}return r},I=e=>new Date(Date.now()).toLocaleDateString(e,{year:"numeric",month:"2-digit",day:"2-digit"}),b=(e,t,o)=>{if(e>0&&t&&o){const n=e===1?t:o.replace("%s",`${e}`),s=I("de-DE");return w("Der Reiskoch","https://www.der-reiskoch.de",n,s,"to-be-approved")}else return""};let i=null;const E=e=>{const t=O(),o=document.getElementById("js-comments-output");o.innerHTML="";let n=null;try{n=JSON.parse(e)}catch(s){console.error(s)}if(n){const s=n.comments,r=n.numberOfToBeApprovedComments;if(r>0){const a=b(r,t.toBeApprovedTextSingular??"",t.toBeApprovedTextPlural??"");if(a&&o){const c=f(a);c&&o.appendChild(c)}}s&&s.forEach(a=>{const c=w(a.name,a.website,C(a.message),a.date,a.type);if(o){const p=f(c);p&&o.appendChild(p)}})}},m=()=>{if(g(),!i)return;const e=new FormData(i);if(e){const t=e.get("sid"),o=e.get("pid");if(t&&o){const n={sectionId:t,pageId:o};v(i.action,n,s=>{E(s)})}}},T=()=>{if(!i)return;const e=new FormData(i),t={sid:e.get("sid"),pid:e.get("pid"),name:e.get("name"),email:e.get("email"),website:e.get("website"),msg:e.get("message")};D(i.action,t,o=>{o&&o.trim()==="OK"?(i.reset(),g(),m()):console.error(o)})},O=()=>{const e=document.getElementById("js-comments-config");let t={};if(e)try{t=JSON.parse(e.innerText)}catch{console.error("Error parsing comments config")}return t};window.addEventListener("load",()=>{if(i=document.getElementById("js-comments-form"),i&&i.addEventListener("submit",t=>{t.preventDefault(),t.stopPropagation(),console.log("submit comment form"),T()}),!i)return;const e=new FormData(i);e.get("sid")&&e.get("pid")&&(m(),setInterval(()=>{m()},l.read.interval))});
