import"./modulepreload-polyfill.js";const w={method:"GET",interval:6e4},h={method:"POST"},l={read:w,write:h},m=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),D=(e,t,o)=>{const n={};m(t,"sectionId")&&(n.sid=t.sectionId),m(t,"pageId")&&(n.pid=t.pageId);let s=!0;for(const a in n){if(m(n,a)){const r=n[a];r&&(e+=(s?"?":"&")+a+"="+encodeURIComponent(r))}s=!1}if(m(n,"sid")&&m(n,"pid")){const a=new XMLHttpRequest;a.open(l.read.method,e),a.onload=()=>{o(a.responseText)},a.send()}else console.error("no sectionId or pageId")},v=(e,t,o)=>{const n=new FormData;for(const a in t)t.hasOwnProperty(a)&&n.append(a,t[a]);const s=new XMLHttpRequest;s.open(l.write.method,e),s.onload=()=>{o(s.responseText)},s.send(n)},g=function(){const e=["cache"];window.caches.keys().then(t=>Promise.all(t.map(o=>{if(!e.includes(o))return window.caches.delete(o)})))},C=e=>{let t="";return e&&(t=e.replace(/(?:\r\n|\r|\n)/g,"<br>")),t},f=e=>{let t=null;return e&&(t=document.createElement("div"),t.className="row",t.innerHTML=e),t},y=(e,t,o)=>{let n="";return e&&o&&(n=`<div class="meta"><div class="name">${t?`<a href="${t}" target="_blank" rel="noopener">${e}</a>`:e}</div><div class="time">${o}</div></div>`),n},u=(e,t,o,n,s)=>{let a="";if(e&&o){let r="";s&&(s.toLowerCase()==="author"&&(r="from-author"),s.toLowerCase()==="to-be-approved"&&(r="to-be-approved"));const c=y(e,t,n);a=`<div class="msg ${r}">${o}</div>`+c}return a},I=e=>new Date(Date.now()).toLocaleDateString(e,{year:"numeric",month:"2-digit",day:"2-digit"}),b=(e,t,o)=>{if(e>0&&t&&o){const n=e===1?t:o.replace("%s",`${e}`),s=I("de-DE");return u("Der Reiskoch","https://www.der-reiskoch.de",n,s,"to-be-approved")}else return""};let i=null;const E=e=>{const t=O(),o=document.getElementById("js-comments-output");o.innerHTML="";let n=null;try{n=JSON.parse(e)}catch(s){console.error(s)}if(n){const s=n.comments,a=n.numberOfToBeApprovedComments;if(a>0){const r=t?t.i18n:{},c=b(a,(r==null?void 0:r.toBeApprovedTextSingular)??"",(r==null?void 0:r.toBeApprovedTextPlural)??"");if(c&&o){const d=f(c);d&&o.appendChild(d)}}s&&s.forEach(r=>{const c=u(r.name,r.website,C(r.message),r.date,r.type);if(o){const d=f(c);d&&o.appendChild(d)}})}},p=()=>{if(g(),!i)return;const e=new FormData(i);if(e){const t=e.get("sid"),o=e.get("pid");if(t&&o){const n={sectionId:t,pageId:o};D(i.action,n,s=>{E(s)})}}},T=()=>{if(!i)return;const e=new FormData(i),t={sid:e.get("sid"),pid:e.get("pid"),name:e.get("name"),email:e.get("email"),website:e.get("website"),msg:e.get("message"),rating:e.get("rating")};v(i.action,t,o=>{o&&o.trim()==="OK"?(i.reset(),g(),p()):console.error(o)})},O=()=>{const e=document.getElementById("js-comments-config");let t={};if(e)try{t=JSON.parse(e.innerText)}catch{console.error("Error parsing comments config")}return t};window.addEventListener("load",()=>{if(i=document.getElementById("js-comments-form"),i&&i.addEventListener("submit",t=>{t.preventDefault(),t.stopPropagation(),console.log("submit comment form"),T()}),!i)return;const e=new FormData(i);e.get("sid")&&e.get("pid")&&(p(),setInterval(()=>{p()},l.read.interval))});
